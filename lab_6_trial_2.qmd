---
title: "Lab 6 github"
author: "Lily Heidger"
format: 
  html:
    embed-resources: true
    warnings: false
    messages: false
editor: source
---

```{r}
library(tidyr)
library(dplyr)
library(tidyverse)
library(kableExtra)
library(knitr)
```


## 1. The following anonymized data show the midterm and final exam grades (%) for eight students. The partial ANOVA table provides sum of squares and mean squares. What is the repeatability of grade performance?

### a. Calculate sA2 from the mean squares and the sample size. What variance component does this quantity estimate? 
22.1
variability of mean across groups, used to estimate population variability
```{r}
grades <- data.frame(individual = c(1,2,3,4,5,6,7,8), midterm = c(78,84,94,82,58,62,81,80), final = c(81,65,75,62,60,86,92,89))

anova_table <- data.frame(source = c("individual", "error", "total"), sum_of_squares = c(1145.94, 956.5, 2102.44), df = c(7,8, NA), mean_squares = c(163.71, 119.56, NA))



SA2 <- (163.71 - 119.56) / 2
```

### b. Calculate the repeatability using sA2 and MSerror. 
0.156
```{r}
repeata <- SA2 / (SA2 + 119.56) 
```

### c. Interpret the repeatability you just calculated. What fraction of the variance among test scores is estimated to reflect true differences among students in performance, and what fraction is measurement variance from test to test within students?
16% of total variance is true differences in student performance
remaining is due to test difficulty variation. 

### d. What assumptions are you making when estimating repeatability to test scores?
The assumptions are normality of the data, independent random samples, and equal variance. 

## 2. Many humans like the effect of caffeine, but it occurs in plants as a deterrent to herbivory by animals. Caffeine is also found in flower nectar, and nectar is meant as a reward for pollinators, not a deterrent. How does caffeine in nectar affect visitation by pollinators? Singaravelan et al. (2005) set up feeding stations where bees were offered a choice between a control solution with 20% sucrose or a caffeinated solution with 20% sucrose plus some quantity of caffeine. Over the course of the experiment, four different concentrations of caffeine were provided: 50, 100, 150, and 200 ppm. The response variable was the difference between the amount of nectar consumed from the caffeine feeders and that removed from the control feeders at the same station (in grams). Here are the data:
```{r}
nectar <- data.frame(ppm_50 = c(-0.4, 0.34, 0.19, 0.05, -0.14), ppm_100 =  c(0.01, -0.39, -0.08, -0.09, -0.31), ppm_150 = c(0.65, 0.53, 0.39, -0.15, 0.46), ppm_200 = c(0.24, 0.44, 0.13, 1.03, 0.05))

nectar_long <- pivot_longer(nectar, 
                            cols = everything(), 
                            names_to = "concentration", 
                            values_to = "response")

# Convert concentration levels to a factor
nectar_long$concentration <- as.factor(gsub("ppm_", "", nectar_long$concentration))
```

## Does the mean amount of nectar taken depend on the concentration of caffeine in the nectar? Carry out ANOVA step by step in the following subsections:

### a. State the null and alternate hypotheses appropriate to this question.
H0: the means of all groups are the same
HA: at least 1 mean is different

### b. Calculate the following summary statistics for each group: sample size, sample mean, sample standard deviation.
The sample size is for each group is 5. 
The sample means are 0.008, -0.172, 0.376, and 0.378. 
The sample standard deviations are 0.289, 0.169, 0.309, 0.393. 
```{r}
# mean(nectar$ppm_50)
# mean(nectar$ppm_100)
# mean(nectar$ppm_150)
# mean(nectar$ppm_200)
# 
# sd(nectar$ppm_50)
# sd(nectar$ppm_100)
# sd(nectar$ppm_150)
# sd(nectar$ppm_200)
```
### c. What is the mean square error?
The mean square error is 0.0905. 
```{r}
nectar_aov <- aov(response ~ concentration, data = nectar_long)
summary(nectar_aov)

```

### d. How many degrees of freedom are associated with error?
16

### e. Calculate the estimate of the grand mean.
The grand mean is 0.1475
```{r}
sum(nectar_long$response)/20
```

### f. Calculate the group sum of squares.
1.1344
### g. Calculate the group degrees of freedom and the group mean square.
3
### h. What is F for this example?
4.18
### i. Find the P-value for this test?
0.0231
### j. Report your results in an ANOVA table.
```{r}
# Run ANOVA
nectar_aov <- aov(response ~ concentration, data = nectar_long)
aov <- summary(nectar_aov)

fit <- aov(response ~ concentration, data = nectar_long)
summary_fit <- summary(fit)

anova_table <- summary_fit[[1]]  # Assuming the first element is the table we're interested in

anova_df <- as.data.frame(anova_table)


kable_styled <- kable(anova_df, format = "html") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

kable_styled
```




## 3. Use the same data as the previous question, and carry out the Tukey-Kramer test to find which pairs of sample means differ from each other. Report your results in a table with the following columns: Group i label, Group j label, difference of sample means for group i and j, standard error, value of test statistic q, critical value of q, and your conclusion about the hypothesis being tested.
Help with table???

```{r}
tukey_result <- TukeyHSD(nectar_aov)
tukey_result

means <- c(0.008, -0.172, 0.376, 0.378)
std_devs <- c(0.289, 0.169, 0.309, 0.393)
n <- 5  # Sample size per group
k <- length(means)  # Number of groups
N <- n * k  # Total number of observations

MSE <- sum(std_devs^2) / k

alpha <- 0.05
df_error <- N - k
critical_q <- qtukey(1 - alpha, k, df_error)
critical_q

#kable(data.frame(Group_i = ))
```
The mean of group 100 is significantly different than groups 150 and 200. 

## 4. Assume that an analysis of variance is conducted for a study where there are N = 50 observations and k = 5 categories. Fill in the blanks in the following ANOVA table:

### With alpha = 0.05, what is your conclusion regarding the null hypothesis that the means of
the categories are equal?


| Source  |  SS  |   df  |   MS   |   F   |
|:-------:|:----:|:-----:|:------:|:-----:|
|  Group  |      |       | 116.3  |       |
|  Error  | 2000 |       |        |       |
|  Total  |      |       |        |       |

## 5. A study classifies 72 observations into nine groups, with eight observations in each group. The study finds that the variance among the 72 observations is 803. Complete the following ANOVA table:

### What do you conclude about the hypothesis that the means of all groups are equal? Assume alpha = 0.05. What can you conclude about the P-value? 


| Source  |  SS  |   df  |   MS   |   F   |
|:-------:|:----:|:-----:|:------:|:-----:|
|  Group  | 6000 |       |        |       |
|  Error  |      |       |        |       |
|  Total  |      |       |        |       |

## 6. Use the Kruskal-Wallis test (with alpha = 0.05) to determine whether you should reject the null hypothesis that the means of the four columns of data are equal:
Fail to reject the null in favor of the alternative that the means are the same. 
```{r}
data <- data.frame(
  Col1 = c(23.1, 13.3, 15.6, 1.2),
  Col2 = c(43.1, 10.2, 16.2, 0.2),
  Col3 = c(56.5, 32.1, 43.3, 24.4),
  Col4 = c(10002.3, 54.4, 8.7, 54.4)
)

data

data_long <- pivot_longer(data, cols = everything(), names_to = "Group", values_to = "Value")

kruskal.test(Value ~ Group, data = data_long)

```
## 7. Huey and Dunham (1987) measured the running speed of fence lizards in Big Bend National Park in Texas. Individual lizards were placed in a 2.3-meter raceway, where their running speeds were measured. Lizards were then tagged and released. The researchers returned to the park the following year, captured many of the same lizards again, and measured their sprint speed in the same way as previously. The pair of measurements for 34 individual lizards is as follows. With these data, calculate the repeatability of the running speed, and what does this metric measure?

```{r}
# Creating the data frame
lizard_data <- data.frame(
  LizardID = c(1:34),
  SprintSpeed1 = c(1.43, 1.56, 1.64, 2.13, 1.96, 1.89, 1.72, 1.80, 1.87, 1.61,
                   1.60, 1.71, 1.83, 1.92, 1.90, 2.06, 2.06, 2.28, 2.44, 2.23,
                   2.53, 2.20, 2.16, 2.25, 2.42, 2.61, 2.62, 3.09, 2.13, 2.44,
                   2.76, 2.96, 3.13, 3.27),
  SprintSpeed2 = c(1.37, 1.30, 1.36, 1.54, 1.82, 1.79, 1.72, 1.80, 1.87, 1.88,
                   1.98, 2.08, 2.16, 2.08, 2.01, 2.03, 1.97, 2.05, 1.92, 2.12,
                   2.11, 2.22, 2.27, 2.39, 2.33, 2.33, 2.39, 2.17, 2.54, 2.63,
                   2.69, 2.64, 2.81, 2.88)
)

head(lizard_data)

```

